from django.http import JsonResponse
from django.views.decorators.csrf import csrf_exempt
import json

class ChatbotService:
    @staticmethod
    def create_simple_text_template(text):
        template = {
            "outputs": [
                {
                    "simpleText": {
                        "text": text
                    }
                }
            ]
        }
        return template

@csrf_exempt
def callback(request):
    if request.method == 'POST':
        payload = json.loads(request.body.decode('utf-8'))
        
        print(payload)
        user_message = payload.get('userRequest', {}).get('utterance', '')

        select_gu = payload.get('contexts', [{}])[0].get('params', {}).get('Select_gu', {}).get('resolvedValue', '')

        response = {
            "version": "2.0",
            "template": ChatbotService.create_simple_text_template(select_gu)
        }

        return JsonResponse(response)